<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление задачами</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 0 20px; }
        .form-group { margin-bottom: 10px; }
        input, button { padding: 8px; }
        .item-card { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .date-header { background: #f0f0f0; padding: 5px; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    
    <h1>Учёт посещаемости студентов 2025-ФГиИБ-ИС-1б</h1>

    <!-- Форма создания -->
    <div style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
        <h3>Добавить новую запись</h3>
        <div class="form-group">
            <input type="text" id="name" placeholder="Имя ученика">
            <input type="date" id="date">
            <input type="text" id="description" placeholder="Прийдёшь/Не прийдёшь">
            <input type="text" id="subject" placeholder="Предмет">
            <button onclick="createItem()">Добавить</button>
        </div>
    </div>

    <hr>

    <button onclick="loadItems()">Обновить список</button>
    <div id="itemsList"></div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';

        // Создание задачи
        async function createItem() {
            const name = document.getElementById('name').value;
            const date = document.getElementById('date').value;
            const description = document.getElementById('description').value;
            const subject = document.getElementById('subject').value;

            const url = `${API_URL}/items/?name=${encodeURIComponent(name)}&date=${encodeURIComponent(date)}&description=${encodeURIComponent(description)}&subject=${encodeURIComponent(subject)}`;
            
            await fetch(url, { method: 'POST' });
            loadItems(); // Обновляем список
        }

        // Загрузка и отображение всех задач (сгруппированных по датам)
        async function loadItems() {
            const response = await fetch(`${API_URL}/items/all/by-dates`);
            const data = await response.json();
            
            const listDiv = document.getElementById('itemsList');
            listDiv.innerHTML = '';

            for (const date in data) {
                const dateHeader = document.createElement('div');
                dateHeader.className = 'date-header';
                dateHeader.innerText = `Дата: ${date}`;
                listDiv.appendChild(dateHeader);

                data[date].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item-card';
                    itemDiv.innerHTML = `
                        <strong>${item.name}</strong><br>
                        <small>${item.description}</small>
                        <small>—</small>
                        <small>${item.subject}</small>
                    `;
                    listDiv.appendChild(itemDiv);
                });
            }
        }

        // Загружает данные когда я запускаю сайт
        loadItems();
    </script>

</body>
</html>
